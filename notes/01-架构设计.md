# 01 - SGLang 架构设计

## 整体架构

```
┌─────────────────────────────────────────────────────┐
│                  Client Layer                        │
│  (HTTP/gRPC API, Python SDK, Language Frontend)     │
└────────────────────┬────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────┐
│              Entrypoint Layer                        │
│    (FastAPI Server, gRPC Server, Offline Engine)    │
└────────────────────┬────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────┐
│              Manager Layer                           │
│  (Request Scheduler, Token Manager, Detokenizer)    │
└────────────────────┬────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────┐
│           Model Executor Layer                       │
│     (Model Loading, Forward Pass, Sampling)         │
└────────────────────┬────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────┐
│           Memory & Cache Layer                       │
│         (RadixAttention, KV Cache)                  │
└─────────────────────────────────────────────────────┘
```

## 核心组件

### 1. Entrypoint 层
**位置**: `srt/entrypoints/`

**职责**:
- HTTP/gRPC API 服务
- 请求接收和响应
- 流式输出处理

**关键文件**:
-

### 2. Manager 层
**位置**: `srt/managers/`

**职责**:
- 请求调度和批处理
- Token 生成管理
- 生命周期管理

**关键组件**:
-

### 3. Model Executor 层
**位置**: `srt/model_executor/`

**职责**:
- 模型推理执行
- 前向传播
- 采样和解码

**关键组件**:
-

### 4. Memory Cache 层
**位置**: `srt/mem_cache/`

**职责**:
- KV Cache 管理
- RadixAttention 实现
- 内存池管理

**关键组件**:
-

## 数据流

### 请求处理流程

1. **请求接收**
   ```
   Client → Entrypoint (FastAPI/gRPC)
   ```

2. **请求入队**
   ```
   Entrypoint → RequestManager → ScheduleQueue
   ```

3. **批处理调度**
   ```
   Scheduler → 选择请求 → 构建Batch
   ```

4. **模型执行**
   ```
   Batch → ModelExecutor → Forward Pass → Sampling
   ```

5. **缓存更新**
   ```
   KV States → RadixCache → Update/Evict
   ```

6. **Token返回**
   ```
   Generated Tokens → Detokenizer → Client
   ```

## 关键设计模式

### 1. Pipeline 模式


### 2. Pool 模式


### 3. Observer 模式


## 性能优化点

### 1. 批处理优化


### 2. 内存优化


### 3. 计算优化


## 扩展性设计

### 1. 硬件抽象


### 2. 模型抽象


## 学习笔记

### 日期:

#### 今日学习内容

#### 关键发现

#### 疑问

